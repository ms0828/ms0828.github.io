---
title: "View Transform - Camera Positioning"
excerpt: ""

categories:
  - Computer Graphics
tags:
  - [tag1, tag2]

permalink: /categories/computer_graphics/camera_positioning/

toc: true
toc_sticky: true

date: 2024-11-04
last_modified_at: 2024-11-04
---
# 🦥View Transform
View Transform은 **월드 좌표계**에서 정의된 3D 객체들을 **카메라 좌표계**로 변환하는 작업이다. 이를 통해, 월드에서 정의된 모든 객체들은 카메라의 시점에서 관측되며, 이 변환은 그래픽 파이프라인에서 중요한 단계 중 하나이다. 이 변환은 우리가 렌더링할 장면이 카메라의 위치와 방향에 맞춰지는 과정에서 **뷰 행렬**로 표현된다.<br>

> 즉, 월드 좌표계가 카메라의 좌표계를 기준으로 회전하여 카메라가 항상 원점에 있고, -z 방향을 바라보는 상태에서 카메라 시점으로 월드를 보는 것처럼 하는 과정

- 월드 좌표계: 3D 장면 전체의 공간을 정의하는 좌표계이다. 이 공간에서 모든 물체들의 위치와 방향이 결정된다. <br>
- 카메라 좌표계: 카메라의 위치를 기준으로 모든 물체들이 어디에 있는지 정의하는 좌표계이다. <br>

> 이러한 두 좌표계 간의 변환이 바로 View Transform (카메라가 움직이는 것처럼 보이지만, 사실은 월드의 모든 물체들이 카메라 좌표계 기준으로 변환되는 것)


<br><br>


## View Transfrom을 수행하기 위한 뷰 변환 행렬을 어떻게 구할 건데?

### Camera Positioning
카메라 위치는 월드 좌표계에서 정의된다. 카메라의 위치와 방향을 설정하기 위해선 세 가지 요소가 필요하다.

- 카메라의 위치: 카메라가 월드에서 위치하는 좌표
- 타겟 위치: 카메라가 어떤 방향을 바라보고 있는지를 나타내는 좌표
- 업 벡터(Up Vector) : 카메라의 수직(위) 방향을 정의함. 이 벡터는 카메라의 "위쪽" 방향을 정의함으로써, 카메라의 기울임 기준이 됨

<br><br>

### Look-At 함수
Look-At 함수는 위에서 언급한 세 요소를 사용하여 월드 좌표계와 카메라 좌표계를 정렬시키는 역할을 한다.
이 함수는 위에서 언급한 세 가지 주요 요소를 사용하여 **월드 좌표계에 배치된 객체들을 특정 카메라 시점에 대한 배치로 바꿔주는 행렬**을 만든다. <br> 

> 따라서 View Transform은 위 행렬을 사용하여 월드 좌표계의 객체들을 카메라 기준으로 변환하는 것이다.

<br>


위와 같은 행렬은 아래에 해당하는 Geometric Transformation들의 곱으로 구성된다.

1. **평행 이동**
  - 카메라를 월드 좌표계에서 원점으로 이동시킨다. 이 과정에서 모든 물체들은 카메라의 위치를 기준으로 반대 방향으로 평행 이동하게 된다. 이 변환은 Tc = translate(-eye)로 표현된다.
2. **회전**
  - 원점으로 이동한 카메라의 좌표계 방향이 월드 좌표계와 동일해지도록 회전을 수행한다. 이 변환은 Rc로 표현된다. 

따라서 위 과정으로 얻은 행렬은 V = Rc * Tc로 표현 될 수 있다.<br>


> 그러나 카메라 좌표계 방향으로부터 월드 좌표계 방향까지의 회전을 계산하는 것은 매우 복잡하고 어렵다.<br> 따라서 이론적으로는 위와 같으나 현실적으로 쉽게 계산하기 위해서는 다른 접근법이 필요하다. (왜 어려운지는 직접 식을 유도 해봐야겠음..)


<br><br>

### 역변환 접근법
위 과정에서 말했듯이 카메라 방향을 월드 좌표계 방향으로 바꾸는 회전을 직접 계산하는 것은 복잡하기에, 다른 접근법으로 뷰 회전 계산을 유도할 수 있다. <br>

바로 **월드 좌표계 방향으로부터 카메라 좌표계 방향까지의 회전=Rw**를 구한 다음에, **Rw의 역행렬**을 이용하여 Rc를 쉽게 구하는 방법이다.<br> (게다가 회전 행렬의 역행렬은 **전치 행렬**로 표현되므로 계산이 간단함)


<br><br>

**위 접근법을 식으로 정리하면 다음과 같다.**
1. W = Tw * Rw 
   - W는 월드 좌표계로 부터 카메라 좌표로 향하는 변환이다. 역변환 접근을 하기 위해서 V가 아닌 W를 먼저 구한다.
2. V = W의 역행렬
   - V(Rc * Tc)를 W(Tw * Rw)의 역행렬로 유도한다. 즉, V = W의 역행렬 = Rw의 역행렬(=Rc) * Tw의 역행렬(=Tc)이다. 특히, R의 역행렬은 전치 행렬과 같으므로 Rc를 쉽게 구할 수 있다.

<br><br>


## 뷰 행렬 구하기
따라서 위에서 설명한 과정(역변환 접근)으로 Look-At함수를 구현한다면 과정은 아래와 같다.

![vt1](/assets\images\posts_img\graphics\vt1.png)

### 1. 월드 좌표계를 카메라 좌표계 방향으로 회전하는 Rw와 이동하는 Tw을 구한다.
Rw을 구하기 위해서는 먼저 카메라 좌표계의 x,y,z축을 구해야한다.
1. 카메라가 바라보는 지점을 f라고 한다면, 카메라 위치(e)로부터 f까지의 노멀 벡터는 n = (f-e) / |f-e| 이다. 즉, 카메라가 바라보는 방향 벡터는 n이다.
2. OpenGL에서 카메라는 기본적으로 -z(0,0,-1) 방향을 바라보고 있으므로, 월드 좌표계는 카메라 좌표계 방향으로 회전하기 위해서는 (0,0,-1)이 n 방향으로 회전(Rw)해야한다.
3. 그 다음, 월드 좌표계의 (0,1,0)은 카메라 좌표계의 y축으로 회전해야한다.
  - 카메라 좌표계의 y축은 어떻게 구하는데? <br>
  - 카메라의 up vector를 이용한다. 카메라의 위쪽 방향을 정의하는 up vector(0,1,0)와 n 벡터를 내적한 값(a)을 n 벡터와 곱하고, u-n*a를 구하면 카메라 좌표계의 y축(위 사진에서 V0)이 된다.
4. 마지막으로 카메라 좌표계에서 -z축과 y축에 해당하는 n벡터와 v벡터를 외적하면, 두 벡터와 직교하는 w벡터(카메라 좌표계의 x축으로 가정한 벡터)가 나온다.

> 따라서 카메라의 좌표계의 x,y,z축은 (w,v,-n)에 해당한다고 할 수 있다. 

<br>

그럼 카메라 좌표계의 각 축에 대한 방향 노말 벡터를 구했으니, 월드 좌표계가 카메라 좌표계 방향으로 회전하는 Rw을 구하면 아래 그림과 같다.

![vt2](/assets\images\posts_img\graphics\vt2.png)

<br>
Tw는 아래와 같다. (월드 좌표계의 원점을 카메라 위치로 이동한 변환 식)

![vt3](/assets\images\posts_img\graphics\vt2.png)

<br><br>

### Rw와 Tw로 역전환 접근법 식을 유도하여 V를 구한다.
V는 W의 역행렬이다. 즉, Rw의 역행렬(전치행렬) * Tw의 역행렬로 나타낼 수 있으므로 아래와 같다.

![vt4](/assets\images\posts_img\graphics\vt4.png)

![vt5](/assets\images\posts_img\graphics\vt5.png)

<br><br>


![vt6](/assets\images\posts_img\graphics\vt6.png)

따라서 위 둘을 곱하여 V를 구할 수 있다.

